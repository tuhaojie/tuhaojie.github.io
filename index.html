<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>最新数据</title>  
    <!-- 这里可以添加其他的头部信息，比如CSS样式表链接、JavaScript脚本链接等 -->  
    <link rel="stylesheet" href="styles.css">
<style>  
 /* 假设 body 是滚动容器 */  
        body {  
		
            position: relative; /* 确保绝对定位的 popup-div 是相对于 body 定位的 */  
            overflow-x: hidden; /* 防止水平滚动条出现 */  
        }  
        table {  
            border-collapse: collapse;  
            width: 100%;  
        }  
        th, td {  
            text-align: left;  
            padding: 8px;  
            border-bottom: 1px solid #5f4f4f;  
			text-align: center
        }  
        tr:hover {background-color: #f5f5f5;}  
		 /* 样式放在这里 */  
    .popupContainer {  
        position: relative; /* 确保绝对定位的弹出框相对于这个容器定位 */  
        height: 100vh; /* 视口高度，用于确保弹出框在整个页面上可见 */  
    }  
    .popup {  
        position: fixed;  
        top: 50%;  
        padding: 20px;  
        background-color: #f9f9f9;  
        border: 1px solid #ccc;  
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);  
        z-index: 1000; /* 确保弹出框在其他内容之上 */  
    }  
    .close-button {  
        position: absolute; /* 绝对定位 */  
        bottom: 10px; /* 距离容器底部的距离 */  
        right: 10px; /* 距离容器右侧的距离 */  
        cursor: pointer; /* 鼠标悬停时变为手形图标 */  
        background-color: red; /* 按钮背景色 */  
        color: white; /* 按钮文本颜色 */  
        border: none; /* 无边框 */  
        padding: 5px 10px; /* 内边距 */  
        font-size: 14px; /* 字体大小 */  
    }  
    .open-button{
       background-color: #1fcff9; /* 按钮背景色 */  
        color: white; /* 按钮文本颜色 */  
        border: none; /* 无边框 */   
        font-size: 14px; /* 字体大小 */  
	}
    .close-button:hover {  
        background-color: darkred; /* 鼠标悬停时的背景色 */  
    }   
    </style>  	
	    <script>
 function showPopup(btn, itemData, type) {
     const popupDiv1111 = document.getElementById('popupDiv');
     if (popupDiv1111 != undefined) {
         popupDiv1111.remove();
     }
     // 创建弹出框元素
     const popupDiv = document.createElement('div');
     popupDiv.classList.add('popup');
     popupDiv.style.position = 'fixed';
     popupDiv.style.top = '100px'; // 加一些间距
     //popupDiv.style.left = `${btn.getBoundingClientRect().left}px`;
     popupDiv.style.padding = '10px';
     popupDiv.style.backgroundColor = 'rgba(245, 245, 245, 0.90)';
     popupDiv.style.border = '1px solid gray';
     popupDiv.style.zIndex = '1000'; // 确保弹出框在其他内容之上
     popupDiv.style.display = 'none'; // 初始时隐藏弹出框
     popupDiv.style.width = '80%';
     popupDiv.style.height = '400px';
     popupDiv.id = 'popupDiv';
     // 设置弹出框的内容
     var title = type == 0 ? '胜平负' : '让球胜平负';
     const popupContent = `
        <h3>${title}-${itemData.matchNumStr}-${itemData.homeTeamAbbName}vs${itemData.awayTeamAbbName}</h3>`;
     var tablePP = `<table id="data-table2">
    <thead>  
        <tr>  
            <th>时间</th>  
            <th>胜</th>  
            <th>平</th>
            <th>负</th> 		
        </tr>  
    </thead>  
    <tbody id="table-body2">`;
     var url = 'https://webapi.sporttery.cn/gateway/jc/football/getFixedBonusV1.qry?clientCode=3001&matchId=' + itemData.matchId;
     // 创建一个新的HTTP请求
     var xhr = new XMLHttpRequest();
     xhr.onload = function () {
         if (xhr.status === 200) {
             var data = JSON.parse(xhr.responseText);
             console.log(data);
             var value1 = type == 0 ? data.value.oddsHistory.hadList : data.value.oddsHistory.hhadList
                 value1.forEach(item => {
                 tablePP = tablePP + `<tr><td>${item.updateTime}</td><td>${item.h}</td><td>${item.d}</td><td>${item.a}</td></tr>`

             });
             tablePP = tablePP + `</tbody>
</table>
<button class="close-button">关闭</button>`;
             popupDiv.innerHTML = popupContent + tablePP;

             // 显示弹出框
             const popupContainer = document.getElementById('popupContainer');
             popupContainer.appendChild(popupDiv);

             // 为关闭按钮添加点击事件监听器
             const closeBtn = popupDiv.querySelector('.close-button');
             closeBtn.addEventListener('click', function () {
                 popupDiv.remove(); // 隐藏弹出框
             });

             // 显示弹出框
             popupDiv.style.display = 'block';

             // 您还可以添加其他的逻辑，比如动画效果等
         } else {
             // 请求失败，处理错误
             console.error('请求失败，状态码：', xhr.status);
         }
     };

     // 发送GET请求
     xhr.open('GET', url, true);
     xhr.send();
	
 }
 function fetchData() {
     // API接口的URL
     var url = 'https://webapi.sporttery.cn/gateway/jc/football/getMatchCalculatorV1.qry?poolCode=hhad,had&channel=c';

     // 创建一个新的HTTP请求
     var xhr = new XMLHttpRequest();

     // 定义请求完成后的回调函数
     xhr.onload = function () {
         if (xhr.status === 200) {
             // 请求成功，处理返回的数据
             var data = JSON.parse(xhr.responseText);
             console.log(data);
             var matchIds = '';
             // 你可以在这里将数据插入到HTML元素中，或者执行其他操作
             var value = data.value;
             var matchInfoList = value.matchInfoList;
             var subMatchList = matchInfoList[0].subMatchList;
             subMatchList.forEach(item => {
                 matchIds = matchIds + item.matchId + ','
             });
             var url2 = 'https://webapi.sporttery.cn/gateway/jc/common/getSupportRateV1.qry?matchIds=' + matchIds + '&poolCode=hhad,had&sportType=1';
             // 创建一个新的HTTP请求
             var xhr2 = new XMLHttpRequest();
             xhr2.onload = function () {
                 if (xhr2.status === 200) {
                     var data2 = JSON.parse(xhr2.responseText);
                     console.log(data2);
                     const tableBody = document.getElementById('table-body');
                     tableBody.innerHTML = '';
                     // 遍历数据并创建表格行
                     var value2 = data2.value;
                     subMatchList.forEach(item => {
                         const had = value2['_' + item.matchId].HAD;
                         const hhad = value2['_' + item.matchId].HHAD
                             var hadBettingSingle = 0;
                         var hhadBettingSingle = 0;
                         item.poolList.forEach(item1 => {
                             if (item1.poolCode == 'HAD') {
                                 hadBettingSingle = item1.bettingSingle;
                             } else if (item1.poolCode == 'HHAD') {
                                 hhadBettingSingle = item1.bettingSingle;
                             }
                         });
                         var h = item.had.h == undefined ? '/' : item.had.h
                             var d = item.had.d == undefined ? '/' : item.had.d
                             var a = item.had.a == undefined ? '/' : item.had.a
                             var hProbability = had == undefined ? '/' : had.hProbability
                             var dProbability = had == undefined ? '/' : had.dProbability
                             var aProbability = had == undefined ? '/' : had.aProbability
                             var hSupportRate = had == undefined ? '/' : had.hSupportRate
                             var dSupportRate = had == undefined ? '/' : had.dSupportRate
                             var aSupportRate = had == undefined ? '/' : had.aSupportRate
                             var win = had == undefined ? '/' : had.win
                             var draw = had == undefined ? '/' : had.draw
                             var lose = had == undefined ? '/' : had.lose
                             var total = had == undefined ? '/' : had.win + had.draw + had.lose
                             var winM = had == undefined ? '/' : count(had.win, h, '*')
                             var drawM = had == undefined ? '/' : count(had.draw, d, '*')
                             var loseM = had == undefined ? '/' : count(had.lose, a, '*')
                             var winY = had == undefined ? '/' : count(total, winM, '-')
                             var drawY = had == undefined ? '/' : count(total, drawM, '-')
                             var loseY = had == undefined ? '/' : count(total, loseM, '-')
                             var hhSupportRate = hhad == undefined ? '/' : hhad.hSupportRate
                             var hdSupportRate = hhad == undefined ? '/' : hhad.dSupportRate
                             var haSupportRate = hhad == undefined ? '/' : hhad.aSupportRate
                             var hwin = hhad == undefined ? '/' : hhad.win
                             var hdraw = hhad == undefined ? '/' : hhad.draw
                             var hlose = hhad == undefined ? '/' : hhad.lose
                             var htotal = hhad == undefined ? '/' : hhad.win + hhad.draw + hhad.lose
                             var hwinM = hhad == undefined ? '/' : count(hhad.win, item.hhad.h, '*')
                             var hdrawM = hhad == undefined ? '/' : count(hhad.draw, item.hhad.d, '*')
                             var hloseM = hhad == undefined ? '/' : count(hhad.lose, item.hhad.a, '*')
                             var hwinY = hhad == undefined ? '/' : count(htotal, hwinM, '-')
                             var hdrawY = hhad == undefined ? '/' : count(htotal, hdrawM, '-')
                             var hloseY = hhad == undefined ? '/' : count(htotal, hloseM, '-')
                             const row1 = document.createElement('tr');
                         const row2 = document.createElement('tr');
                         const row3 = document.createElement('tr');
                         const row4 = document.createElement('tr');
                         const row5 = document.createElement('tr');
                         const row6 = document.createElement('tr');
                         const row7 = document.createElement('tr');
                         const row8 = document.createElement('tr');
                         row1.innerHTML = `
                        <td>${item.matchNumStr}</td>  
                        <td>${item.homeRank}${item.homeTeamAbbName}</td> 
                        <td></td>						
                        <td>${item.awayRank}${item.awayTeamAbbName}</td>
                        <td></td>
                    `;
                         row2.innerHTML = `
                        <td>支持量比例</td>  
                        <td>${hSupportRate}</td> 
                        <td>${dSupportRate}</td>						
                        <td>${aSupportRate}</td>
                        <td></td>
                    `;
                         if (hadBettingSingle == 1) {
                             row3.innerHTML = `
                        <td><div class="hadGL" style="background-image:url(	https://static.sporttery.cn/res_1_0/jcw/images/jc_calculator/single.gif);background-repeat:no-repeat;background-position:left top;">赔率</div></td>  
                        <td>${h}</td> 
                        <td>${d}</td>						
                        <td>${a}</td>
                    `;
                         } else {
                             row3.innerHTML = `
                        <td>赔率</td>  
                        <td>${h}</td> 
                        <td>${d}</td>						
                        <td>${a}</td>
                    `;
                         }
                         const td3 = document.createElement('td');
                         const btn3 = document.createElement('button');
                         btn3.classList.add('open-button');
                         btn3.textContent = '变';
                         btn3.setAttribute('data-item', JSON.stringify(item));
                         // 为按钮添加点击事件监听器
                         btn3.addEventListener('click', function () {
                             // 从 data-item 属性中解析数据对象
                             const itemData = JSON.parse(this.getAttribute('data-item'));
                             showPopup(this, itemData, 0);
                         });
                         td3.appendChild(btn3);
                         row3.appendChild(td3);
                         row4.innerHTML = `
                        <td>赔率胜率</td>  
                        <td>${hProbability}</td> 
                        <td>${dProbability}</td>						
                        <td>${aProbability}</td>
                        <td></td>
                    `;
                         row5.innerHTML = `
                        <td>支持量</td>  
                        <td>${win}</td> 
                        <td>${draw}</td>						
                        <td>${lose}</td>
                        <td></td>
                    `;
                         row6.innerHTML = `
                        <td>总奖池</td>  
                        <td colspan="3" style="text-align: center; vertical-align: middle; ">${total}</td> 
                        <td></td>
                    `;
                         row7.innerHTML = `
                        <td>奖池赔付</td>  
                        <td>${winM}</td> 
                        <td>${drawM}</td>						
                        <td>${loseM}</td>
                        <td></td>
                    `;
                         row8.innerHTML = `
                        <td>庄家盈亏</td>  
                        <td>${winY}</td> 
                        <td>${drawY}</td>						
                        <td>${loseY}</td>
                        <td></td>
                    `;
                         const row9 = document.createElement('tr');
                         const row10 = document.createElement('tr');
                         const row11 = document.createElement('tr');
                         const row12 = document.createElement('tr');
                         const row13 = document.createElement('tr');
                         const row14 = document.createElement('tr');
                         const row15 = document.createElement('tr');
                         const row16 = document.createElement('tr');
                         row10.innerHTML = `
                        <td>${item.hhad.goalLine}支持量比例</td>  
                        <td>${hhSupportRate}</td> 
                        <td>${hdSupportRate}</td>						
                        <td>${haSupportRate}</td>
                        <td></td>
                    `;
					 if (hhadBettingSingle == 1) {
                             row11.innerHTML = `
                        <td><div class="hadGL" style="background-image:url(	https://static.sporttery.cn/res_1_0/jcw/images/jc_calculator/single.gif);background-repeat:no-repeat;background-position:left top;">赔率</div></td>  
                          <td>${item.hhad.h}</td> 
                        <td>${item.hhad.d}</td>						
                        <td>${item.hhad.a}</td>
                    `;
                         } else {
                             row11.innerHTML = `
                        <td>赔率</td>  
                          <td>${item.hhad.h}</td> 
                        <td>${item.hhad.d}</td>						
                        <td>${item.hhad.a}</td>
                    `;
                       }
					    const td11 = document.createElement('td');
                         const btn11 = document.createElement('button');
                         btn11.classList.add('open-button');
                         btn11.textContent = '变';
                         btn11.setAttribute('data-item', JSON.stringify(item));
                         // 为按钮添加点击事件监听器
                         btn11.addEventListener('click', function () {
                             // 从 data-item 属性中解析数据对象
                             const itemData = JSON.parse(this.getAttribute('data-item'));
                             showPopup(this, itemData, 1);
                         });
                         td11.appendChild(btn11);
                         row11.appendChild(td11);
                         row12.innerHTML = `
                        <td>赔率胜率</td>  
                        <td>${hhad.hProbability}</td> 
                        <td>${hhad.dProbability}</td>						
                        <td>${hhad.aProbability}</td>
                        <td></td>
                    `;
                         row13.innerHTML = `
                        <td>支持量</td>  
                        <td>${hwin}</td> 
                        <td>${hdraw}</td>						
                        <td>${hlose}</td>
                        <td></td>
                    `;
                         row14.innerHTML = `
                        <td>总奖池</td>  
                        <td colspan="3" style="text-align: center; vertical-align: middle; ">${htotal}</td> 
                        <td></td>
                    `;
                         row15.innerHTML = `
                        <td>奖池赔付</td>  
                        <td>${hwinM}</td> 
                        <td>${hdrawM}</td>						
                        <td>${hloseM}</td>
                        <td></td>
                    `;
                         row16.innerHTML = `
                        <td>庄家盈亏</td>  
                        <td>${hwinY}</td> 
                        <td>${hdrawY}</td>						
                        <td>${hloseY}</td>
                        <td></td>
                    `;
                         row9.innerHTML = `
                        <td colspan="5" style="text-align: center; vertical-align: middle; background: #ff5f5f;">下一场</td> 
                        
                    `;
                         tableBody.appendChild(row1);
                         tableBody.appendChild(row2);
                         tableBody.appendChild(row3);
                         tableBody.appendChild(row4);
                         tableBody.appendChild(row5);
                         tableBody.appendChild(row6);
                         tableBody.appendChild(row7);
                         tableBody.appendChild(row8);
                         tableBody.appendChild(row10);
                         tableBody.appendChild(row11);
                         tableBody.appendChild(row12);
                         tableBody.appendChild(row13);
                         tableBody.appendChild(row14);
                         tableBody.appendChild(row15);
                         tableBody.appendChild(row16);
                         tableBody.appendChild(row9);
                     });
                 } else {
                     // 请求失败，处理错误
                     console.error('请求失败，状态码：', xhr2.status);
                 }
             };

             // 发送GET请求
             xhr2.open('GET', url2, true);
             xhr2.send();
         } else {
             // 请求失败，处理错误
             console.error('请求失败，状态码：', xhr.status);
         }
     };

     // 发送GET请求
     xhr.open('GET', url, true);
     xhr.send();
 }
 function count(num1, num2, symbol) {
     let str1 = num1.toString();
     let str2 = num2.toString();
     let result,
     len1,
     len2,
     step;
     try {
         len1 = str1.split('.')[1].length
     } catch (e) {
         len1 = 0
     };
     try {
         len2 = str2.split('.')[1].length
     } catch (e) {
         len2 = 0
     };
     step = Math.pow(10, Math.max(len1, len2));
     let a = parseInt(num1 * step);
     let b = parseInt(num2 * step);
     switch (symbol) {
     case '+':
         result = (a + b) / step
         break;
     case "-":
         result = (a - b) / step
         break;
     case "*":
         result = (a * b) / step / step
         break;
     case "/":
         result = a / b
             break;
     default:
         break;
     }
     return result;
 }
	</script>  
</head>  

<body>  
 <button onclick="fetchData()">调用API接口</button>  
 <table id="data-table">  
    <thead>  
        <tr>  
            <th></th>  
            <th>胜</th>  
            <th>平</th>
            <th>负</th> 		
            <th></th> 
        </tr>  
    </thead>  
    <tbody id="table-body"></tbody>  
</table> 
<div id="popupContainer"></div> 
</body>  
</html>